<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>Zeroth Law of thermodynamics</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="sins/MOMstyle.css">
	<script type="text/javascript" src='sins/jquery.min.js'></script>
	<script type="text/javascript" src='sins/jquery-ui.min.js'></script>
	<script type="module">

		import * as THREE from './js/three.module.js';

		var temperature=30;
		var flag=true;
		var container, stats;
		var camera, scene, renderer;
		var mouseX = 0, mouseY = 0;

		var windowHalfX = window.innerWidth / 2;
		var windowHalfY = window.innerHeight / 2;

		init();
		animate();

		function init() {

			container = document.getElementById( 'container' );
			container.width=500;
			container.height=400;

			camera = new THREE.PerspectiveCamera( 20, 1.5, 1, 10000 );
			camera.position.z = 2600;

			scene = new THREE.Scene();
			scene.background = new THREE.Color( 0xffffff );

			var light = new THREE.DirectionalLight( 0xffffff );
			light.position.set( 0, 0, 1 );
			scene.add( light );

			var light2 = new THREE.DirectionalLight( 0xffffff );
			light2.position.set( 0, 0, -1 );
			scene.add( light2 );
			
			var canvas = document.createElement( 'canvas' );
			canvas.width = 128;
			canvas.height = 128;

			var context = canvas.getContext( '2d' );
			var gradient = context.createRadialGradient( canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width / 2 );
			gradient.addColorStop( 0.1, 'rgba(210,210,210,1)' );	//shadow
			gradient.addColorStop( 1, 'rgba(255,255,255,1)' );

			context.fillStyle = gradient;
			context.fillRect( 0, 0, canvas.width, canvas.height );

			var shadowTexture = new THREE.CanvasTexture( canvas );

			var shadowMaterial = new THREE.MeshBasicMaterial( { map: shadowTexture } );
			var shadowGeo = new THREE.PlaneBufferGeometry( 300, 300, 1, 1 );

			var shadowMesh;

			shadowMesh = new THREE.Mesh( shadowGeo, shadowMaterial );
			shadowMesh.position.y = - 250;
			shadowMesh.rotation.x = - Math.PI / 2;
			scene.add( shadowMesh );

			shadowMesh = new THREE.Mesh( shadowGeo, shadowMaterial );
			shadowMesh.position.y = - 250;
			shadowMesh.position.x = - 400;
			shadowMesh.rotation.x = - Math.PI / 2;
			scene.add( shadowMesh );

			shadowMesh = new THREE.Mesh( shadowGeo, shadowMaterial );
			shadowMesh.position.y = - 250;
			shadowMesh.position.x =   400;
			shadowMesh.rotation.x = - Math.PI / 2;
			scene.add( shadowMesh );

			var radius = 200;

			var geometry1 = new THREE.IcosahedronBufferGeometry( radius, 2 );

			var count = geometry1.attributes.position.count;
			geometry1.setAttribute( 'color', new THREE.BufferAttribute( new Float32Array( count * 3 ), 3 ) );

			var geometry2  = geometry1.clone();
			var geometry3  = geometry1.clone();

			var color	   = new THREE.Color();
			// var positions1 = geometry1.attributes.position;
			// var positions2 = geometry2.attributes.position;
			// var positions3 = geometry3.attributes.position;
			var colors1	   = geometry1.attributes.color;
			var colors2    = geometry2.attributes.color;
			var colors3    = geometry3.attributes.color;

			var colour_array=["0xf10103","0xee0205","0xeb0308","0xe8050a","0xe5060d","0xe20710","0xdf0812","0xdd0915","0xda0a18","0xd70c1a","0xd40d1d","0xd10e1f","0xce0f22","0xcb1025","0xc81127","0xc5122a","0xc2142d","0xbf152f","0xbc1632","0xb91735","0xb61837","0xb4193a","0xb11b3c","0xae1c3f","0xab1d42","0xa81e44","0xa51f47","0xa22049","0x9f214c","0x9c234f","0x992451","0x962554","0x932657","0x902759","0x8d285c","0x8b2a5f","0x882b61","0x852c64","0x822d66","0x7f2e69","0x7c2f6c","0x79306e","0x763271","0x733373","0x703476","0x6d3579","0x6a367b","0x67377e","0x643881","0x613a83","0x5f3b86","0x5c3c88","0x593d8b","0x563e8e","0x533f90","0x504193","0x4d4296","0x4a4398","0x47449b","0x44459d","0x4146a0","0x3e47a3","0x3b49a5","0x384aa8","0x364bab","0x334cad","0x304db0","0x2d4eb3","0x2a50b5","0x2751b8","0x2452ba"];
			// https://codepen.io/BangEqual/pen/VLNowO
			varinit();

			colour_it();

			function colour_it() {
				alert("called colour_it");
				for (var i = 0; i < count; i++) {

					color.setHex(colour_array[$('#l1spinner').spinner("value") - 30]);										// Left Ball
					colors1.setXYZ(i, color.r, color.g, color.b);

					color.setHex(colour_array[$('#l1spinner').spinner("value") - 30]);										// Right Ball
					colors2.setXYZ(i, color.r, color.g, color.b);

					color.setHex(colour_array[$('#l1spinner').spinner("value") - 30]);										// Middle Ball
					colors3.setXYZ(i, color.r, color.g, color.b);

				}

			}

			var material = new THREE.MeshPhongMaterial( {
				color: 0xffffff,
				flatShading: true,
				vertexColors: THREE.VertexColors,
				shininess: 0
			} );

			var wireframeMaterial = new THREE.MeshBasicMaterial( { color: 0x000000, wireframe: true, transparent: true } );

			var mesh = new THREE.Mesh( geometry1, material );
			var wireframe = new THREE.Mesh( geometry1, wireframeMaterial );
			mesh.add( wireframe );
			mesh.position.x = - 400;
			scene.add( mesh );

			var mesh = new THREE.Mesh( geometry2, material );
			var wireframe = new THREE.Mesh( geometry2, wireframeMaterial );
			mesh.add( wireframe );
			mesh.position.x = 400;
			scene.add( mesh );

			var mesh = new THREE.Mesh( geometry3, material );
			var wireframe = new THREE.Mesh( geometry3, wireframeMaterial );
			mesh.add( wireframe );
			scene.add( mesh );

			renderer = new THREE.WebGLRenderer( { antialias: true } );
			renderer.setPixelRatio( window.devicePixelRatio );
			// renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setSize( 570, 400 );
			container.appendChild( renderer.domElement );

			// stats = new Stats();
			// container.appendChild( stats.dom );

			document.addEventListener( 'mousemove', onDocumentMouseMove, false );
			document.getElementById("playpausebutton").addEventListener( 'click', startstop, false );

			$(window).bind('mousewheel DOMMouseScroll', function(event){
				if (event.originalEvent.wheelDelta > 0 || event.originalEvent.detail < 0) {

					if(camera.position.z > -4000){

						camera.position.z = camera.position.z - 100;

					}

				}
				else {

					if(camera.position.z < 4000) {

						camera.position.z = camera.position.z + 100;

					}

				}
			});


			function varinit()
			{
				varchange();

				$('#l1slider').slider("value", 30);
				$('#l1spinner').spinner("value", 30);
				document.getElementById("commentboxleft").innerHTML=$('#l1spinner').spinner("value")+" Degrees Celsius";

			}

			function varchange()
			{

				$('#l1slider').slider({ max : 100, min : 30, step : 1 });					// slider initialisation : jQuery widget
				$('#l1spinner').spinner({ max : 100, min : 30, step : 1 });					// number initialisation : jQuery widget

				// monitoring change in value and connecting slider and number
				// setting trace point coordinate arrays to empty on change of link length

				$( "#l1slider" ).on( "slide", function( e, ui ) { $('#l1spinner').spinner("value",ui.value);varupdate();  } );
				$( "#l1spinner" ).on( "spin", function( e, ui ) { $('#l1slider').slider("value",ui.value); } );
				$( "#l1spinner" ).on( "change", function() {  varchange() } );

				varupdate();

			}

			//Computing of various system parameters

			function varupdate()
			{

				$('#l1slider').slider("value", $('#l1spinner').spinner('value'));  //updating slider location with change in spinner(debug) -->
				temperature=$('#l1spinner').spinner("value");
				console.log(temperature);
				console.log(colour_array[$('#l1spinner').spinner("value")-30]);
				document.getElementById("commentboxleft").innerHTML=$('#l1spinner').spinner("value")+" Degrees Celsius";
				colour_it();

			}

		}

		function onDocumentMouseMove( event ) {

			mouseX = ( event.clientX - windowHalfX );
			mouseY = ( event.clientY - windowHalfY );

		}

		function animate() {

			requestAnimationFrame( animate );
			render();

		}

		function render() {

			camera.position.x += ( mouseX - camera.position.x ) * 0.05;
			camera.position.y += ( - mouseY - camera.position.y ) * 0.05;

			camera.lookAt( scene.position );
			renderer.render( scene, camera );

		}

		function startstop() {

			if(flag===true){

				document.getElementById('playpausebutton').src="sins/blueplaydull.png";
				flag=false;

			}else{

				document.getElementById('playpausebutton').src="sins/bluepausedull.png";
				flag=true;

			}

		}

	</script>

	<noscript>The simulation requires JavaScript to be enabled.</noscript>

</head>
<body>

<div id="container">
	<div id="simtitle">Zeroth Law of Thermodynamics</div>
	<div id="titleincanvas"></div>
	<div id="commentboxleft"></div>
	<div id="commentboxright"></div>
	<div id="vartitle">VARIABLES</div>

	<div id="variables">
		<div class="variable">
			<div class="varname">
				<p title="Temperature">Temp(C<sup>o</sup>)</p>
				<input id="l1spinner" type="number" placeholder="30" id="Temp" autocomplete="off" >
				<div id="l1slider"></div>
			</div>
		</div>
	</div>
</div>
<!--    DND-Title of region for controls display-->
<div id="ctrltitle">CONTROLS</div>
<!-- Region for User controls of simulation-->
<div id="controls">
	<img id="playpausebutton" src="sins/bluepausedull.png" />
</div>
<!-- DND-Copyright display-->
<div id="copyright" title="Developer : SOLVEr"> Copyright &copy; SOLVE The Virtual Lab @ NITK Surathkal </div>
</body>
</html>